<html>
	<head>
		<title>Project Final- WORLD</title>
		<script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="threejs/three.js"></script>
		<script src="threejs/Detector.js"></script>
		<script src="threejs/renderers/CanvasRenderer.js"></script>
		<script src="threejs/renderers/Projector.js"></script>
		<script src="threejs/core/Raycaster.js"></script>
		<script src="threejs/Stats.js"></script>
		<script src="threejs/controls/OrbitControls.js"></script>
		<script src="threejs/postprocessing/EffectComposer.js"></script>
		<script src="threejs/postprocessing/RenderPass.js"></script>
		<script src="threejs/postprocessing/ShaderPass.js"></script>
		<script src="threejs/postprocessing/MaskPass.js"></script>
		<script src="threejs/shaders/CopyShader.js"></script>
		<script src="threejs/shaders/FXAAShader.js"></script>
		<script src="js/main.js" type="text/javascript"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TweenMax.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="style.css">
	</head>
	<body>
        <div id="pais"></div>
        <div id="coordenadas"></div>
        <div id="demografia"></div>
        <div class="dropdown" id="dropdown_menu">
            <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                Dropdown Example
                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
                <li><input type="radio" name="escolha" value="EN.POP.DNST" id="option1" /><span id="option1_element">Population density of</span></li>
                <li><input type="radio" name="escolha" value="SP.POP.GROW" id="option2"/><span id="option2_element">Population growt</span></li>
                <li><input type="radio" name="escolha" value="SH.DYN.MORT" id="option3"/><span id="option3_element">Mortality rate</span></li>
                <li><input type="radio" name="escolha" value="SP.DYN.TFRT.IN" id="option4"/><span id="option4_element">Fertility rate, total
																																																											<p>(births per woman)</p></span></li>
            </ul>
        </div>
        <script id="globeVertexShader" type="x-shader/x-vertex">
            varying vec3 vNormal;
            varying vec2 vUv;
            void main()
            {
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0);
            vNormal = normalize( normalMatrix * normal );
            vUv = uv;
            }
        </script>

        <script id="globeFragmentShader" type="x-shader/x-fragment">
            uniform sampler2D mapIndex;
            uniform sampler2D lookup;
            uniform sampler2D outline;
            uniform sampler2D texturaMundo;
            varying vec3 vNormal;
            varying vec2 vUv;
            void main()
            {
            vec4 mapColor = texture2D( mapIndex, vUv );
            float indexedColor = mapColor.y;
            vec2 lookupUV = vec2( indexedColor, 0.0 );
            vec4 lookupColor = texture2D( lookup, lookupUV );
            vec4 outlineColor = texture2D( outline, vUv );
            vec4 blendColor = texture2D( texturaMundo, vUv );
            gl_FragColor = 0.5 * outlineColor + 1.0 * lookupColor + 0.5 * blendColor;
            }
        </script>
        <script>
            //Variaveis
            var container, scene, camera, renderer, controls, stats, mapCanvas, mapContext, CanvasReferencia, ContextReferencia, TexturaReferencia, composer;
            var projector = new THREE.Projector();
            var mouse2D = new THREE.Vector3(0, 0, 0.5);
            var mesh;
            var renderer_grafico, scene_grafico, camera_grafico, geometry_grafico, tween, aux=0, expandTween = [], spritey_numero_array = [], spritey_numero, barras_obj;
            //Grafico
            var tick = 0;
            var size = 0.25;
            var bar = new Array();
            var cores = ["blue", "red", "yellow", "purple", "brown", "white", "cyan", "orange", "gold", "green", "gray"];

            //Lista de paises com codigo de cor correspondente
            var IndexCorPais = {
                'PE': 1, 'BF': 2, 'FR': 3, 'LY': 4, 'BY': 5, 'PK': 6, 'ID': 7, 'YE': 8, 'MG': 9, 'BO': 10,
                'CI': 11, 'DZ': 12, 'CH': 13, 'CM': 14, 'MK': 15, 'BW': 16, 'UA': 17, 'KE': 18, 'TW': 19, 'JO': 20,
                'MX': 21, 'AE': 22, 'BZ': 23, 'BR': 24, 'SL': 25, 'ML': 26, 'CD': 27, 'IT': 28, 'SO': 29, 'AF': 30,
                'BD': 31, 'DO': 32, 'GW': 33, 'GH': 34, 'AT': 35, 'SE': 36, 'TR': 37, 'UG': 38, 'MZ': 39, 'JP': 40,
                'NZ': 41, 'CU': 42, 'VE': 43, 'PT': 44, 'CO': 45, 'MR': 46, 'AO': 47, 'DE': 48, 'SD': 49, 'TH': 50,
                'AU': 51, 'PG': 52, 'IQ': 53, 'HR': 54, 'GL': 55, 'NE': 56, 'DK': 57, 'LV': 58, 'RO': 59, 'ZM': 60,
                'IR': 61, 'MM': 62, 'ET': 63, 'GT': 64, 'SR': 65, 'EH': 66, 'CZ': 67, 'TD': 68, 'AL': 69, 'FI': 70,
                'SY': 71, 'KG': 72, 'SB': 73, 'OM': 74, 'PA': 75, 'AR': 76, 'GB': 77, 'CR': 78, 'PY': 79, 'GN': 80,
                'IE': 81, 'NG': 82, 'TN': 83, 'PL': 84, 'NA': 85, 'ZA': 86, 'EG': 87, 'TZ': 88, 'GE': 89, 'SA': 90,
                'VN': 91, 'RU': 92, 'HT': 93, 'BA': 94, 'IN': 95, 'CN': 96, 'CA': 97, 'SV': 98, 'GY': 99, 'BE': 100,
                'GQ': 101, 'LS': 102, 'BG': 103, 'BI': 104, 'DJ': 105, 'AZ': 106, 'MY': 107, 'PH': 108, 'UY': 109, 'CG': 110,
                'RS': 111, 'ME': 112, 'EE': 113, 'RW': 114, 'AM': 115, 'SN': 116, 'TG': 117, 'ES': 118, 'GA': 119, 'HU': 120,
                'MW': 121, 'TJ': 122, 'KH': 123, 'KR': 124, 'HN': 125, 'IS': 126, 'NI': 127, 'CL': 128, 'MA': 129, 'LR': 130,
                'NL': 131, 'CF': 132, 'SK': 133, 'LT': 134, 'ZW': 135, 'LK': 136, 'IL': 137, 'LA': 138, 'KP': 139, 'GR': 140,
                'TM': 141, 'EC': 142, 'BJ': 143, 'SI': 144, 'NO': 145, 'MD': 146, 'LB': 147, 'NP': 148, 'ER': 149, 'US': 150,
                'KZ': 151, 'AQ': 152, 'SZ': 153, 'UZ': 154, 'MN': 155, 'BT': 156, 'NC': 157, 'FJ': 158, 'KW': 159, 'TL': 160,
                'BS': 161, 'VU': 162, 'FK': 163, 'GM': 164, 'QA': 165, 'JM': 166, 'CY': 167, 'PR': 168, 'PS': 169, 'BN': 170,
                'TT': 171, 'CV': 172, 'PF': 173, 'WS': 174, 'LU': 175, 'KM': 176, 'MU': 177, 'FO': 178, 'ST': 179, 'AN': 180,
                'DM': 181, 'TO': 182, 'KI': 183, 'FM': 184, 'BH': 185, 'AD': 186, 'MP': 187, 'PW': 188, 'SC': 189, 'AG': 190,
                'BB': 191, 'TC': 192, 'VC': 193, 'LC': 194, 'YT': 195, 'VI': 196, 'GD': 197, 'MT': 198, 'MV': 199, 'KY': 200,
                'KN': 201, 'MS': 202, 'BL': 203, 'NU': 204, 'PM': 205, 'CK': 206, 'WF': 207, 'AS': 208, 'MH': 209, 'AW': 210,
                'LI': 211, 'VG': 212, 'SH': 213, 'JE': 214, 'AI': 215, 'MF_1_': 216, 'GG': 217, 'SM': 218, 'BM': 219, 'TV': 220,
                'NR': 221, 'GI': 222, 'PN': 223, 'MC': 224, 'VA': 225, 'IM': 226, 'GU': 227, 'SG': 228
            };

            initGlobo();
            initGrafico();

            //Extras
            function checkOption() {
                if (document.getElementById('option1').checked) {
                    document.getElementById("demografia").innerHTML = document.getElementById('option1_element').innerHTML;
                    return document.getElementById('option1').value;
                } else if (document.getElementById('option2').checked) {
                    document.getElementById("demografia").innerHTML = document.getElementById('option2_element').innerHTML;
                    return document.getElementById('option2').value;
                } else if (document.getElementById('option3').checked) {
                    document.getElementById("demografia").innerHTML = document.getElementById('option3_element').innerHTML;
                    return document.getElementById('option3').value;
                } else if (document.getElementById('option4').checked) {
                    document.getElementById("demografia").innerHTML = document.getElementById('option4_element').innerHTML;
                    return document.getElementById('option4').value;
                }
            }

            //Globo
            function initGlobo() {
                scene = new THREE.Scene();

                //camera
                var ecra_widht = 850;//window.innerWidth * 0.625;
                var ecra_height = window.innerHeight;//window.innerHeight * 0.975;
                var fov = 45;  //angulo da camara
                var aspect = ecra_widht / ecra_height; //aspect ratio
                var near = 0.1; //limite minimo?
                var far = 20000; //limite maximo?
                camera = new THREE.PerspectiveCamera(fov, aspect, near, far);
                scene.add(camera);
                camera.position.set(0, 250, 250);
                camera.lookAt(scene.position); //Isso faz com que a c�mera veja a posi��o do vetor no espa�o global, desde que o �parent� seja a cena ou na posi��o (0,0,0)

                //Insesir inform��o na div teste
                if (Detector.webgl) {
                    renderer = new THREE.WebGLRenderer({ antialias: false });
                } else {
                    renderer = new THREE.CanvasRenderer();
                }
                renderer.setSize(850, ecra_height);

                renderer.sortObjects = false;
                renderer.generateMipmaps = false;
                renderer.setClearColor(0x000000);

                document.body.appendChild(renderer.domElement);

                //controlador da camara
                controls = new THREE.OrbitControls(camera, renderer.domElement);

                //luz para a esfera
                var light = new THREE.PointLight(0xffffff);
                light.position.set(100, 250, 100);
                scene.add(light);

                // Cria��o de uma textura de referencia para que cada pais tenha um codigo de cor cinza diferente dos outros.
                CanvasReferencia = document.createElement('canvas');
                CanvasReferencia.width = 256;
                CanvasReferencia.height = 1;
                ContextReferencia = CanvasReferencia.getContext('2d');
                TexturaReferencia = new THREE.Texture(CanvasReferencia);
                TexturaReferencia.magFilter = THREE.NearestFilter;
                TexturaReferencia.minFilter = THREE.NearestFilter;
                TexturaReferencia.needsUpdate = true;

                var mapaTextura = THREE.ImageUtils.loadTexture("images/earth-index-shifted-gray.png");
                mapaTextura.magFilter = THREE.NearestFilter;
                mapaTextura.minFilter = THREE.NearestFilter;
                mapaTextura.needsUpdate = true;

                var mapaFronteiras = THREE.ImageUtils.loadTexture("images/earth-outline-shifted-gray.png");
                mapaFronteiras.needsUpdate = true;

                var texturaMundo = THREE.ImageUtils.loadTexture("images/earth-day.jpg");

                var planeMaterial = new THREE.ShaderMaterial({
                    uniforms: {
                        width: { type: "f", value: window.innerWidth },
                        height: { type: "f", value: window.innerHeight },
                        mapIndex: { type: "t", value: mapaTextura },
                        outline: { type: "t", value: mapaFronteiras },
                        lookup: { type: "t", value: TexturaReferencia },
                        texturaMundo: { type: "t", value: texturaMundo }
                    },
                    vertexShader: document.getElementById('globeVertexShader').textContent,
                    fragmentShader: document.getElementById('globeFragmentShader').textContent
                });

                var geometry = new THREE.SphereGeometry(100, 64, 32);
                mesh = new THREE.Mesh(geometry, planeMaterial);
                mesh.position.set(0, 0, 0);
                scene.add(mesh);

                document.addEventListener('mousemove', mouseMove, false);
                document.addEventListener('mousedown', mouseClick, false);

                mapCanvas = document.createElement('canvas');
                mapCanvas.width = 4096;
                mapCanvas.height = 2048;
                mapContext = mapCanvas.getContext('2d');
                var imageObj = new Image();
                imageObj.onload = function () {
                    mapContext.drawImage(imageObj, 0, 0);
                };
                imageObj.src = 'images/earth-index-shifted-gray.png';

                renderer.autoClear = false;

                composer = new THREE.EffectComposer(renderer);

                var renderModel = new THREE.RenderPass(scene, camera);

                var effectFXAA = new THREE.ShaderPass(THREE.FXAAShader);
                var width = window.innerWidth || 2;
                var height = window.innerHeight || 2;
                effectFXAA.uniforms['resolution'].value.set(1 / width, 1 / height);

                var effectCopy = new THREE.ShaderPass(THREE.CopyShader);
                effectCopy.renderToScreen = true;

                composer.addPass(renderModel);
                composer.addPass(effectFXAA);
                composer.addPass(effectCopy);

            }
            //Para mexer no globo
            function mouseMove(event) {
                mouse2D.x = (event.clientX / window.innerWidth) * 2 - 1;
                //console.log(mouse2D.x);
                mouse2D.y = -(event.clientY / window.innerHeight) * 2 + 1;
                //console.log(mouse2D.y);
            }
            //Para interagir com o globo
            function mouseClick(event) {
                var raycaster = new THREE.Raycaster();
                mouse2D.x = (event.clientX / 850) * 2 - 1;
                mouse2D.y = -(event.clientY / window.innerHeight) * 2 + 1;
                var countryCode = -1;
                raycaster.setFromCamera(mouse2D.clone(), camera);
                var intersectionList = raycaster.intersectObject(mesh);
                if (intersectionList.length > 0) {

                    data = intersectionList[0];
                    var d = data.point.clone().normalize();
                    var u = Math.round(4096 * (1 - (0.5 + Math.atan2(d.z, d.x) / (2 * Math.PI))));
                    var v = Math.round(2048 * (0.5 - Math.asin(d.y) / Math.PI));
                    var p = mapContext.getImageData(u, v, 1, 1).data;
                    countryCode = p[0];
                    for (var prop in IndexCorPais) {

                        if (IndexCorPais.hasOwnProperty(prop)) {
                            if (IndexCorPais[prop] === countryCode) {
                                if (aux != 0) {
                                    for (var i = 0; i < expandTween.length; i++) {
                                        expandTween[i].updateTo({ y: 0.1 }, true); //paracada barra do grafico voltar a 0,1 (para nao sair da matrix e evitar erros na consola do browser!)
                                    }
                                    expandTween.length = 0;
                                    bar.length = 0;
                                    console.log(spritey_numero_array);
                                    for (var i = 0; i < spritey_numero_array.length; i++) {
                                        scene_grafico.remove(spritey_numero_array[i]);
                                    }
                                    aux = 1;
                                }
                                $.ajax({
                                    url: 'http://api.worldbank.org/countries/' + prop + '?format=jsonP',
                                    dataType: 'jsonp',
                                    jsonp: "prefix",
                                    jsonpCallback: "jquery_" + (new Date).getTime(),
                                    success: function (res) {
                                        console.log(res[0]);
                                        var data2 = JSON.stringify(res[1]);
                                        var data = JSON.parse(data2);

                                        $("#pais").html("<p><span id='pais_nome'>"+data[0].name + "</span> - " + data[0].capitalCity + "</p>");
                                        $("#coordenadas").html("<p id='coordenadas_latlog'>Lat: " + data[0].longitude + " / Log: " + data[0].latitude +"</p>");
                                    },
                                    error: function (xhr, status, error) {
                                        console.log("Error");
                                    }
                                });
                                //var indicador = 'EN.POP.DNST'; //Population density
                                //var indicador = 'SP.POP.GROW'; //Population growth
                                //var indicador = 'SH.DYN.MORT';
                                var indicador = checkOption();
                                $.ajax({
                                    //url: 'http://api.worldbank.org/countries/'+ prop +'/indicators/NY.GNP.PCAP.CD?date=2000:2010&format=jsonp',
                                    url: 'http://api.worldbank.org/countries/'+ prop +'/indicators/'+ indicador +'?date=2005:2010&format=jsonp',
                                    dataType: 'jsonp',
                                    jsonp: "prefix",
                                    jsonpCallback: "jquery_" + (new Date).getTime(),
                                    success: function (data) {
                                        var maximo = 0;
                                        var minimo = 100000;
                                        dados = data[1];
                                        for (var i = 0; i < dados.length; i++) {
                                            if (dados[i].value > maximo) {
                                                maximo = dados[i].value;
                                            }
                                            if (dados[i].value < minimo) {
                                                minimo = dados[i].value;
                                            }
                                        }
                                        for (var i = 0; i < dados.length; i++) {
                                            if (indicador === 'EN.POP.DNST') {
                                                var calculo = (20*(Math.round(dados[i].value * 100) / 100))/365 ;//* 0.05;
                                                console.log(calculo);
                                               // var string = n.toString().split(".");
                                                //var calculo = string[0]/5;
                                                var dados_valores = Math.round(dados[i].value * 10) / 10;
                                            } else if (indicador === 'SP.POP.GROW') {
                                                var calculo = dados[i].value * 10;//(Math.round(dados[i].value * 100) / 100);
                                                var dados_valores = Math.round(dados[i].value * 10)/10;
                                            } else if (indicador === 'SH.DYN.MORT') {
                                                if (dados[i].value > 18) {
                                                    var calculo = (Math.round(dados[i].value * 100)/100) * 0.15;
                                                    var dados_valores = Math.round(dados[i].value * 10) / 10
                                                    //INSERIR AVISO DE RECALCULO
                                                } else {
                                                    var calculo = Math.round(dados[i].value * 100) / 100
                                                    var dados_valores = Math.round(dados[i].value * 10) / 10
                                                }
                                            } else if (indicador === 'SP.DYN.TFRT.IN') {
                                                var calculo = dados[i].value*2;
																								var dados_valores = Math.round(dados[i].value * 10) / 10

                                            }


                                            if (i === 0) {
                                                if(maximo === dados[i].value){
                                                    createBar(1, i, "red"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                } else if (minimo === dados[i].value) {
                                                    createBar(1, i, "blue"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                } else {
                                                    createBar(1, i, "gray"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                }
                                            } else {
                                                if (maximo === dados[i].value) {
                                                    createBar(1, i * -5, "red"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                } else if (minimo === dados[i].value) {
                                                    createBar(1, i * -5, "blue"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                } else {
                                                    createBar(1, i * -5, "gray"/*cores[i]*/, calculo, dados[i].date, dados_valores);
                                                }
                                            }
                                        }
                                    },
                                    error: function (xhr, status, error) {
                                        console.log("Error");
                                    }
                                });
                            }
                        }
                    }

                    for (var i = 0; i < 228; i++) {
                        if (i == 0)
                            ContextReferencia.fillStyle = "rgba(0,0,0,1.0)"
                        else if (i == countryCode)
                            ContextReferencia.fillStyle = "rgba(0,0,255,0.5)"
                        else
                            ContextReferencia.fillStyle = "rgba(0,0,0,1.0)"

                        ContextReferencia.fillRect(i, 0, 1, 1);
                    }

                    TexturaReferencia.needsUpdate = true;
                }
            }

            function animate() {
                requestAnimationFrame(animate);
                render();
                update();
            }

            function update() {
                controls.update();
                if (camera.position.length() < 300) camera.position.setLength(300);
                if (camera.position.length() > 1000) camera.position.setLength(1000);
            }

            function initGrafico() {
							//https://codepen.io/DapperDirewolf/pen/mevjKp

                // Setup Scene / Camera
                scene_grafico = new THREE.Scene();

								/*camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 2000);

    						camera.position.set(100, 100, 100);
    						camera.lookAt(new THREE.Vector3(100, 40, 0));*/


								camera_grafico = new THREE.PerspectiveCamera(42, 480 / window.innerHeight, 0.1, 2000);
                //camera_grafico.position.z = 50
								//anda para a direita,;
                camera_grafico.position.set(90, 15, 18);
								//camera_grafico.position.set(80, 35, 18);
								//anda para a esquerda, para baixo e cima1

                camera_grafico.lookAt(new THREE.Vector3(-15, 32, -30));




                //camera_grafico.position.set(500, 500, -100);
              //  camera_grafico.position.set(90, 0, 0);
                //console.log(camera_grafico.position);
                //camera_grafico.position.set(100,100,100);
             //   camera_grafico.lookAt(new THREE.Vector3(0, 0, 0));
               // camera_grafico.lookAt(new THREE.Vector3(200, -150, 0));

                // Setup Renderer
                renderer_grafico = new THREE.WebGLRenderer({
                    antialias: true
                });

                renderer_grafico.shadowMap.enabled = true;
                renderer_grafico.shadowMap.type = THREE.PCFSoftShadowMap;



                renderer_grafico.setSize(480, window.innerHeight);
                renderer.render(scene_grafico, camera_grafico);

                //var container = document.getElementById("ola");
                //container.appendChild(renderer_grafico.domElement);
                document.body.appendChild(renderer_grafico.domElement);
                //var camaraControls_grafico = new THREE.OrbitControls(camera_grafico, renderer_grafico.domElement);
                createLight();
            }

            function createBar(total, z, colour, height, texto, value) {
                for (var i = 0; i < total; i += 1) {
                    geometry_grafico = new THREE.BoxGeometry(2, 2, 2);
                    geometry_grafico.mergeVertices();
                    geometry_grafico.applyMatrix(new THREE.Matrix4().makeTranslation(0, 1, z));

                    var material = new THREE.MeshPhongMaterial({
                        color: colour
                    });

                    id = new THREE.Mesh(geometry_grafico, material);

                    id.position.x = i * 5;
                    id.name = "bar-" + i;
                    id.castShadow = true;
                    id.receiveShadow = true;

                    scene_grafico.add(id);
                    bar.push(id, height);

                    selectedBar = bar[Math.floor(bar[0].length / 2)];

                    for (var i = 0; i < geometry_grafico.vertices.length; i++) {
                        if (i == 2) {
													//ano
                            var spritey = makeTextSprite(" " + texto + " ", { fontsize: 40, backgroundColor: { r: 255, g: 100, b: 100, a: 1 } });
                            spritey.position.set(geometry_grafico.vertices[i].x + 5, geometry_grafico.vertices[i].y-3, geometry_grafico.vertices[i].z - 4);
                            scene_grafico.add(spritey);
                        } else if (i == 4) {
                            spritey_numero = makeTextSprite(" " + value + " ", { fontsize: 35, backgroundColor: { r: 255, g: 100, b: 100, a: 1 } });
                            spritey_numero.position.set(geometry_grafico.vertices[i].x + 6, geometry_grafico.vertices[i].y + height *1.9, geometry_grafico.vertices[i].z - 2);
                            spritey_numero_array.push(spritey_numero);
                            scene_grafico.add(spritey_numero);
                        }

                    }


                }

                for (var i = 1; i < bar.length; i += 2) {
                    expandTween.push(new TweenMax.to(bar[i - 1].scale, 1, {

                        ease: Elastic.easeOut.config(1, 1),

                        y: bar[i],

                        delay: i * 0.25
                        })
                    );
                }
                aux = 1; //true
            }

            function makeTextSprite(message, opts) {
                var parameters = opts || {};
                var fontface = parameters.fontface || 'Helvetica';
                var fontsize = parameters.fontsize || 50;
                var canvas = document.createElement('canvas');
                var context = canvas.getContext('2d');
                context.font = fontsize + "px " + fontface;

                // get size data (height depends only on font size)
                var metrics = context.measureText(message);
                var textWidth = metrics.width;

                // text color
                context.fillStyle = 'rgba(255, 255, 255, 1.0)';
                context.fillText(message, 0, fontsize);

                // canvas contents will be used for a texture
                var texture = new THREE.Texture(canvas)
                texture.minFilter = THREE.LinearFilter;
                texture.needsUpdate = true;

                var spriteMaterial = new THREE.SpriteMaterial({
                    map: texture,
                    //useScreenCoordinates: false
                });
                var sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(15, 5, 1);
                return sprite;
            }

            function createLight() {

                var ambient = new THREE.AmbientLight(0x999999);
                var spot = new THREE.SpotLight({
                    color: 0xffffff,
                    intensity: 0.1
                });

                spot.position.set(-50, 100, 100);
                spot.castShadow = true;
                spot.shadowDarkness = 0.2;

                scene_grafico.add(ambient, spot);
            }

            var render = function () {
                renderer_grafico.clear();
                requestAnimationFrame(render);

                renderer.render(scene, camera);
                renderer_grafico.render(scene_grafico, camera_grafico);
            }
            render();
        </script>
	</body>
</html>
